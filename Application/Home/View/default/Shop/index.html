<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" class="chezi" style="background:#f6f6f6;">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>{$web.title}</title>
<include file="Public:head_exam" />
<link rel="stylesheet" type="text/css" href="__PUBLIC__/home/shop.css?1">
<script src="__PUBLIC__/home/func.js"></script>
</head>
<body>
<div class="mybody">
<div class="curnav" id="curnav" style="position:fixed; top:0px; left:0px; z-index:1001"><div><a  class="back" href="{$backurl}"><em>d</em></a><center><form action="__CONTROLLER__/search/"  method="get" onsubmit="return checkform(this);"><input type="text" name="key"  placeholder="请输入店铺名/商品名"/><input type="submit" value="查询" name="btsubmit"/></form></center><a class="amenu">≡</a></div></div>
<div class="w800" style="margin-top:45px;">
<!--	  焦点图开孡-->
			<div class="huandeng-photolist" id="huandenglist"> 
			 <div  class="rel">
				<div  id="huandeng_slider" class="huandeng-slider"> 
				<foreach name="info.jiaodantu" item="row">
				 <div class="item"  style="background-color:#FFFFFF;">
					<img src="__PUBLIC__/images/logo.gif"  data-src="__ROOT__/{$row}" onclick="showbig(this)">
				 </div>
				 </foreach>
				</div>
			</div>
			</div>
<!--			焦点图结束-->
</div>
         <div  class="w800" style="margin-top:10px;">
            <div id="indexclass" class="iclass">
			  <div class="rel">
			   <div class="item" data-id="{$row.id}"><a class="aurl" style="color:#009900" href="__CONTROLLER__/plists/djid/{$dianjia.id}/"><div class="img"></div><span class="title">全部</span></a></div>
			   <foreach name="pclass" item="row">
			   <div class="item" title="{$row.title}" data-id="{$row.id}">
			   <a class="aurl" href="__CONTROLLER__/plists/djid/{$dianjia.id}/djclassid/{$row.id}"><div class="img"></div><span class="title">{$row.title}</span></a>
			   </div>
			  </foreach>
			 </div>
		   </div>
        </div>

  <link type="text/css" media="all" rel="stylesheet" href="__PUBLIC__/slick-1.6.0/tabhead.css" />
  <script language="javascript" src="__PUBLIC__/slick-1.6.0/slick/slick.min.js"></script>
    <script language="javascript" src="__PUBLIC__/js/touchslider.js" title="201705240301改过后的" qq="632175205"></script>
  <link rel="stylesheet" type="text/css" href="__PUBLIC__/slick-1.6.0/slick/slick.css">
  <link rel="stylesheet" type="text/css" href="__PUBLIC__/slick-1.6.0/slick/slick-theme.css">
<link rel="stylesheet" type="text/css" href="__PUBLIC__/home/huandengslider.css">
<style>
.tabpane{ width:800px; float:left; min-height:600px;}
</style>
<div class="mymain" style=" width:100%;">


<div class="w800" style="margin-top:10px;">
	<div class="tabhead tabhead4" id="tabhead4">
		  <span class="active"><center>附近商铺</center></span>
		  <span><center>全部宝贝</center></span>
		  <span><center>新品上架</center></span>
		  <span><center>推荐商品</center></span>
		  <b class="border"></b>
	</div>
</div>
<div class="w800">
  <div class="khfxWarp tabpane_slider" id="tabpane_slider">
  <div class="tabpanelist">
	<div class="tabpane" style="display:block">
       <!--开始-->
			<div class="pkuang" style="margin-top:0px; border-top:0px;">
					 <div class="inner">
						  <div class="shoptitle"><span class="tit">商铺列表</span><span class="more"><a class="aurl" href="__CONTROLLER__/djlist/">&gt;&gt;更多</a></span></div>
						  <div class="plist" style="margin-top:0px;">
						   <foreach name="shop" item="row">
							 <div class="item" data-id="{$row.id}" >
							 <a href="__CONTROLLER__/home/djid/{$row.id}/" class="aurl">
							 <div  class="rel" style="border:0px;">
								<div class="left"> 
								<div class="photo"><img data-src="__ROOT__/{$row.photo}" src="__PUBLIC__/images/logo.gif"/></div>
								</div>
								<div class="right">  
										<div class="title">{$row.shopname}</div>
								</div>
							 </div>
							 </a>
							 </div>
						   </foreach>
							<empty name="list">
							  <div class="divnull">暂时没有推荐商品</div>
							</empty>
						  </div>
						  <div class="clear"></div>
					</div>
			</div>
	   <!--结束-->
  </div>
    <div class="tabpane" id="productlist">
	    <div class="loading"><div class="con1">正在加载...</div></div>
    </div>
    <div class="tabpane">
	    <div class="loading"><div class="con1">正在加载...</div></div>
    </div>
    <div class="tabpane">
       <!--开始-->
			<div class="pkuang" style="margin-top:0px; border-top:0px;">
					 <div class="inner">
						  <div class="shoptitle"><span class="tit">推荐商品</span><span class="more"><a class="aurl" href="__CONTROLLER__/pclass/djid/{$dianjia.id}/">&gt;&gt;更多</a></span></div>
						  <div class="plist" style="margin-top:0px;">
						   <foreach name="list" item="row">
							 <div class="item" data-id="{$row.id}" >
							 <a href="__CONTROLLER__/pdetail/djid/{$row.dianjiaid}/id/{$row.id}" class="aurl">
							 <div  class="rel" style="border:0px;">
								<div class="left"> 
								<div class="photo"><img data-src="__ROOT__/{$row.photo}" src="__PUBLIC__/images/logo.gif"/></div>
								</div>
								<div class="right">  
										<div class="title">{$row.title}</div>
										<div class="price"><i>¥</i><span class="s1">{$row.price}</span><span class="s2">¥{$row.prices}</span></div>
								</div>
							 </div>
							 </a>
							 </div>
						   </foreach>
							<empty name="list">
							  <div class="divnull">暂时没有推荐商品</div>
							</empty>
						  </div>
						  <div class="clear"></div>
					</div>
			</div>
			<div class="pkuang" style="margin-top:0px; border-top:0px;">
					 <div class="inner">
						  <div class="shoptitle"><span class="tit">热卖商品</span><span class="more"><a class="aurl" href="__CONTROLLER__/plists/djid/{$dianjia.id}/">&gt;&gt;更多</a></span></div>
						  <div class="plist" style="margin-top:0px;">
						   <foreach name="list" item="row">
							 <div class="item" data-id="{$row.id}" >
							 <a href="__CONTROLLER__/pdetail/djid/{$row.dianjiaid}/id/{$row.id}" class="aurl">
							 <div  class="rel" style="border:0px;">
								<div class="left"> 
								<div class="photo"><img data-src="__ROOT__/{$row.photo}" src="__PUBLIC__/images/logo.gif"/></div>
								</div>
								<div class="right">  
										<div class="title">{$row.title}</div>
										<div class="price"><i>¥</i><span class="s1">{$row.price}</span><span class="s2">¥{$row.prices}</span></div>
								</div>
							 </div>
							 </a>
							 </div>
						   </foreach>
							<empty name="list">
							  <div class="divnull">暂时没有热卖商品</div>
							</empty>
						  </div>
						  <div class="clear"></div>
					</div>
			</div>
	   <!--结束-->
    </div>
  </div>
  </div>
</div>
<div style="height:10px;"></div>
</div>
</div>
<div id="pro_tmp" style="display:none;">
		<div class="item" data-id="{id}" >
		 <a href="__CONTROLLER__/pdetail/djid/{dianjiaid}/id/{id}" class="aurl">
			<div  class="rel" style="border:0px;">
			<div class="left"> 
			<div class="photo"><img data-src="__ROOT__/{photo}" src="__PUBLIC__/images/logo.gif"/></div>
			</div>
			<div class="right">  
			<div class="title">{title}</div>
			<div class="price"><i>¥</i><span class="s1">{price}</span><span class="s2">¥{prices}</span></div>
			</div>
			</div>
		 </a>
		</div>
</div>
			<script>
			function showslider(){
				if($(window).width()<800){
					  $("#huandeng_slider").slick({
						dots: true,
						infinite: true,
						autoplay:true,
						easing:"linear",
						variableWidth: false
					  });
				}else{
					 $("#huandenglist").css({"height":"300px"});
					  $("#huandeng_slider .item").css({"height":"300px"});
					  $("#huandeng_slider").slick({
						dots: true,
						infinite: true,
						autoplay:true,
						easing:"linear",
						variableWidth: false
					  });
				}
			}
			
			</script>
<script>
  init_show_img({objs:$("img")});
</script>
<script>
var djid="{$dianjia.id}";
$(window).resize(function(){
    resize_h_scroll({id:"pclass"});
});
resize_h_scroll({id:"pclass"});
show_hide_daohang_index();

//$.cookie("currentMenuID", "menuID", { path: "/"}); 
//var weburl="__ROOT__";//右键查看网页源码，你会看出这个有值，有关 thinkphp 常量：http://document.thinkphp.cn/manual_3_2.html#const_reference
</script>
<script>
 var itemIndex = 0;
function tabpaneslider(){
   
//	var  tabpane_slider=$("#tabpane_slider");
//	tabpane_slider.slick({
//	dots: false,
//	infinite: true,
//	autoplay:false,
//	easing:"linear",
//	variableWidth: false
//  });
  
    var tabLoadEndArray = [false, false, false];
    var tabLenghtArray = [28, 15, 47, 47];
    var tabScroolTopArray = [0, 0, 0,0];
	var tabs=$('.tabhead span');
	var tabhead=$('.tabhead');
	var showpanenav=function(index){
	     itemIndex = index;
        tabScroolTopArray[itemIndex] = $(window).scrollTop();
        var $this = tabs.eq(index);
       // $(window).scrollTop(tabScroolTopArray[itemIndex]);
        $this.addClass('active').siblings('.tabhead span').removeClass('active');
        $('.tabhead .border').css('left', $this.offset().left-tabhead.offset().left + 'px');
		var h=$(".tabpane").eq(itemIndex).height();
		$(".tabpane").parent().parent().height(h);
		var tabpane=$(".tabpane").eq(index);
		panedata(index);
	}
    tabs.on('click', function () {
		 showpanenav($(this).index());
		// tabpane_slider.slick("slickGoTo",itemIndex);
    });
	var tt=new TouchSlider({id:"tabpane_slider",'auto':'0',fx:'ease-out',direction:'left',speed:600,timeout:5000,'before':function(index){
		showpanenav(index);
	}});

	var as=$('.tabhead span');
	var index=0;
	as.each(function(i){
			$(this).attr("index",i);
			$(this).click(function(){
				tt.slide($(this).attr("index"));
				return false;
			});
	})



    
//	tabpane_slider.on('beforeChange', function(event, slick, currentSlide, nextSlide){
//          //console.log(slick);
//		  if(slick.$list.context.outerHTML.indexOf("tabpane_slider")!=-1){
//		    showpanenav(nextSlide);
//		  }
//    });
}
$(document).scroll(function(){
  var parent=$(this);
  if(itemIndex==1){
	   var zh=parent.height(); //注 jq版本1.7.2获取失败
		if($(window).height()+parent.scrollTop()+10>zh){
              panedata(itemIndex);
		}
    }

});
function panedata(index){
   if(index==1){
            var  tabpane=$(".tabpane").eq(index);
			if(tabpane.attr("data-page")==null){tabpane.attr("data-page",0);}
			if(tabpane.attr("data-bool")==null){tabpane.attr("data-bool",1);}
			var oldpage=parseInt(tabpane.attr("data-page")),newpage=oldpage+1;
			 if(oldpage!=-1&&tabpane.attr("data-bool")!=0){
			    tabpane.parent().parent().height(tabpane.height());
				tabpane.attr("data-page",newpage);
				load_product({parent:tabpane,itemhtml:$("#pro_tmp").html(),listclass:"plist",data:{p:newpage,isajax:1,djid:djid},success:function(o){
				//alert($(window).height()+"="+$(document).height());
				  if($(window).height()==$(document).height()){
				      panedata(index);
				  }
				}});
				
			 }
			 
   }
   if(index==2){
            var  tabpane=$(".tabpane").eq(index);
			if(tabpane.attr("data-page")==null){tabpane.attr("data-page",0);}
			if(tabpane.attr("data-bool")==null){tabpane.attr("data-bool",1);}
			var oldpage=parseInt(tabpane.attr("data-page")),newpage=oldpage+1;
			 if(oldpage!=-1&&tabpane.attr("data-bool")!=0){
			    tabpane.parent().parent().height(tabpane.height());
				load_product({parent:tabpane,itemhtml:$("#pro_tmp").html(),listclass:"plist",data:{p:newpage,isajax:1,djid:djid,xinpin:1}});
				tabpane.attr("data-page",-1);
			 }
			 
			 
   }
}
function load_product(opt){
	var tabpane= opt.parent;
	
     opt.parent.attr("data-bool",0);
    opt.parent.find(".loadingxiao").show();
   $.ajax({
   url:conf.url+"/plists/",
   dataType:"text",
   type:"get",
   data:opt.data,
   success:function(res){

     opt.parent.attr("data-bool",1);
     opt.parent.find(".loading").hide();
     var json=eval("("+res+")"),num=0,plist=opt.parent.find("."+opt.listclass),loadingxiao=opt.parent.find(".loadingxiao");
	  if(res=="null"){
	     if(opt.data.p==1){
		    if(typeof(opt.data.xinpin)!="undefined"){
		      opt.parent.find(".loading").show().find(".con1").html("找不到商家新品");
			}else{
			  opt.parent.find(".loading").show().find(".con1").html("找不到商家产品");
			}
		 }
	     json=[];
	  }
	 if(plist.length<1){
	    opt.parent.append("<div class=\""+opt.listclass+"\" style=\"margin-top:0px;\"></div");
	    plist=opt.parent.find("."+opt.listclass);
	 }
	 if(loadingxiao.length<1){
	   opt.parent.append("<div class=\"loadingxiao\" style=\"display:none\">正在加载更多...</div");
	   loadingxiao=opt.parent.find(".loadingxiao");
	 }else{
	   loadingxiao.hide();
	 }
	  for(var k in json){
			  var row=json[k];
			  if(typeof(row.id)!="undefined"){
			  var line=opt.itemhtml;
			  line=line.replace(new RegExp("{id}","gm"),row.id); 
			  line=line.replace(new RegExp("{price}","gm"),row.price); 
			  line=line.replace(new RegExp("{prices}","gm"),row.prices); 
			  line=line.replace(new RegExp("{title}","gm"),row.title); 
			  line=line.replace(new RegExp("{dianjiaid}","gm"),row.dianjiaid); 
			  line=line.replace(new RegExp("{photo}","gm"),row.photo); 
			  var newite=$(line)
			   plist.append(newite);
			   init_show_img({objs:newite.find("img")});
			  num++;
			  }
	  }
      if(num==0){
	     opt.parent.attr("data-page",-1);
	  }else{
	     if(typeof(opt.success)!="undefined"){
	       opt.success({parent:opt.parent,res:res});
		 }
	  }
   }
   }) 
}
tabpaneslider();
showslider();
</script>

</body>
</html>