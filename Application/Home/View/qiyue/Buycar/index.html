<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>我的购物车</title>
<script language="javascript" src="__PUBLIC__/js/jquery-1.7.2.min.js" title="加载jq库"></script>  
<script language="javascript" src="__PUBLIC__/js/jquery.cookie.js"></script>  
<style>
body{ margin:0px;}
.mycontent{ width:1000px; margin-left:auto; margin-right:auto;}
.table_product{ width:100%;}
.table_product tr th{ background-color:#CCCCCC; padding-top:15px; padding-bottom:15px; font-size:15px; text-align:left;}
.table_product tr th.th1{ text-align:center}
.table_product tr td{ background-color:#F5F5F5;font-size:15px; text-align:left;}
.table_product tr td.td1{ width:60px; text-align:center;}
.table_product tr td.op{}
.table_product tr td.tdcenter{ text-align:center;}
.bt_del{}
.mytitle{ height:auto; width:100%; overflow:hidden;}
.mytitle h1{ display:inline; float:left; margin:0px; padding:0px; padding-top:20px;padding-bottom:20px;}
.mytitle span{ display:inline; float:right;}
.mytitle span .back{ text-align:right; padding-top:40px; display:block; text-decoration:none; color:#009900; font-size:20px; font-weight:bold;}
.car_null{ padding-top:20px; padding-bottom:20px;}
.car_menu{padding:20px; background-color:#CCCCCC; }
.bt_car_all{ background-color:#3C0; padding:10px;background-color:#F60; border:0px; cursor:pointer;}
.bt_car_all:hover{ color:#ffffff; }
</style>
</head>

<body>
<include file="Public:header" />
<div class="mycontent">
<div class="mytitle"><h1>我的购物车</h1><span><a href="__APP__/Home/Product/" class="back">返回</a></span></div>
<table cellspacing="1"  cellpadding="7" border="0" class="table_product">
<tr><th valign="middle" class="th1">ID</th><th>书名</th><th>单价(元)</th><th>数量</th><th>小计</th><th>操作</th></tr>
  <notempty name="list">
  <foreach name="list" item="row">
    <tr>
      <td class="td1">{$row.bookid}</td>
      <td>{$row[bookname]}</td>
      <td>{$row[bookprice]}</td>
      <td class="tdcenter"><input type="button"  class="jian_jia" value="-" data-bookid="{$row[bookid]}" /><input type="text" id="txt_{$row[bookid]}" value="{$row[mycountz]}"/><input type="button"  class="jian_jia" value="+" data-bookid="{$row[bookid]}"/></td>
      <td><span id="price_{$row[bookid]}" data-bookprice="{$row[bookprice]}">￥{$row[mypricez]}</span></td>
      <td class="op"><input type="button" class="bt_car" data-bookid="{$row[bookid]}" value="立即购买"/><input type="button" class="bt_del" data-bookid="{$row[bookid]}" value="移除"/></td>
    </tr>
 </foreach>
 </notempty>
 <tr class="tr_null" style="display:none;"><td colspan="6"><div class="car_null">购物车里没有书籍<a href="__APP__/Home/Product/" style="padding-left:10px;">去选购</a></div></td></tr>
</table>
<div class="car_menu"><table style="width:100%;"><tr><td></td><td align="right"><input type="button" value="提交订单" class="bt_car_all"/></td></tr></table></div>
</div>
</body>
<script>
//相关jquery文档，用它时记得引用jquery文件  http://www.w3school.com.cn/jquery/
//$("jian_jia").each()//jquery写法  记得先打这样子，接了打函数$("jian_jia").each(function(){}) ;
var weburl="__ROOT__";//右键查看网页源码，你会看出这个有值，有关 thinkphp 常量：http://document.thinkphp.cn/manual_3_2.html#const_reference
 $(".jian_jia").each(function(){
	 //jquery写法 $(this).click(); 记得先打这样子，接了打函数$(this).click(function(){});
	 $(this).click(function(){
		 // alert($(this).val());
		  var bookid=$(this).attr("data-bookid");
		  var oTxt=$("#txt_"+bookid);
		  var oPrice=$("#price_"+bookid);
		  var price=oPrice.attr("data-bookprice");//获取属性值
		  var num=parseInt(oTxt.val());//当前数量
		  if($(this).val()=="-"){
			  if(num>1){
				  num=num-1;
			  }
		  }else{
			    num=num+1;
		  }
		  var pricez=price*num;
		  oPrice.html("￥"+pricez);
		  oTxt.val(num);
		  
		  //不会就百度
		  //记得先打$.ajax()再打$.ajax({})接了再打参数，
		  $.ajax({
			  url:weburl+"/index.php/Home/Buycar/update",
			  data:{'bookid':bookid,'num':num},
			  success:function(data){
				   alert(data); //这个是ajax成功后的回调函数,中的data是返回回来的数据
			  }
		   });
		  
	 });
 });
 if( $(".bt_del").length<=0){
   $(".tr_null").show();
   $(".car_menu").hide();
 }
 $(".bt_del").each(function(i){
	 $(this).attr("data-index",i);
	  $(this).click(function(){
		   var bookid=$(this).attr("data-bookid");
		   var index=$(this).attr("data-index");
		  if(confirm("确定要移除?")){
			  //不会就百度
			  //记得先打$.ajax()再打$.ajax({})接了再打参数，
			  $.ajax({
				  url:weburl+"/index.php/Home/Buycar/del",
				  data:{'bookid':bookid,'index':index},
				  success:function(data){
					   alert(data); //这个是ajax成功后的回调函数,中的data是返回回来的数据
				  }
			   });
			 $(this).parent().parent().remove();//移除tr 按钮所在的父级元素就是td那么就是$(this).parent(),td上级元素则是tr所以就是$(this).parent().parent()
			 if( $(".bt_del").length<=0){
			   $(".tr_null").show();
			   $(".car_menu").hide();
			 }
		  }
	  });
  });
  //给下单个单按钮添加click事件
 $(".bt_car").each(function(i){
	  $(this).attr("data-index",i);
	  var bookid=$(this).attr("data-bookid");
	  $(this).click(function(){
	     window.location=weburl+"/index.php/Home/Buycar/buy/bookid/"+bookid;
	  });
 });
   //给多个下单按钮添加click事件
 $(".bt_car_all").each(function(i){
	  $(this).attr("data-index",i);
	  var bookid=$(this).attr("data-bookid");
	  $(this).click(function(){
	     window.location=weburl+"/index.php/Home/Buycar/buy/";
	  });
 });
</script>
</html>
