<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>我的订单</title>
<script language="javascript" src="__PUBLIC__/js/jquery-1.7.2.min.js"></script>  
<script language="javascript" src="__PUBLIC__/js/jquery.cookie.js"></script>  
<style>
body{ margin:0px;}
.mycontent{ width:1000px; margin-left:auto; margin-right:auto;}
.table_product{ width:100%;}
.table_product tr th{ background-color:#CCCCCC; padding-top:15px; padding-bottom:15px; font-size:15px; text-align:left;}
.table_product tr th.th1{ text-align:center}
.table_product tr td{ background-color:#F5F5F5;font-size:15px; text-align:left;}
.table_product tr td.td1{ width:60px; text-align:center;}
.table_product tr td.op{}
.bt_del{}
.mytitle{ height:auto; width:100%; overflow:hidden;}
.mytitle h1{ display:inline; float:left; margin:0px; padding:0px; padding-top:20px;padding-bottom:20px;}
.mytitle a{ display:inline; float:right; line-height:50px;}
</style>
</head>

<body>
<include file="Public:header" />
<div class="mycontent">
<div class="mytitle"><h1>我的订单</h1></div>
<table cellspacing="1"  cellpadding="7" border="0" class="table_product">
<tr><th valign="middle" class="th1">ID</th><th>订单编号</th><th>数量</th><th>总金额</th><th>会员名</th><th>下单日期</th><th>操作</th></tr>
  <foreach name="list" item="row">
    <tr class="tr_line" data-id="{$row[ordersid]}">
      <td class="td1" ><input value="{$row.ordersid}" type="checkbox" /></td>
      <td>{$row[ordersno]}</td>
      <td>{$row[nums]}</td>
      <td>￥{$row[total]}</td>
      <td>{$row[username]}</td>
      <td>{$row[addtime]}</td>
      <td class="op"><input type="button" class="bt_del" data-id="{$row[ordersid]}" value="删除"/><input type="button" class="bt_info" data-id="{$row[ordersid]}" value="查看明细"/></td>
    </tr>
    <tr  style="display:none;" id="tr_{$row[ordersid]}">
     <td colspan="7"> <foreach name="row[detail]" item="detail">
       <p>{$key+1}.{$detail["bookname"]}:<span style="color:#F00;">{$detail["bookprice"]}块</span> 数量：<span style="color:#F00;">{$detail["nums"]}件</span></p>
     </foreach>
     </td>
    </tr>
 </foreach>
</table>
<style>
.pagenav{padding: 20px;background-color: #CCC;}
.pagenav a{ padding-left:10px; padding-right:10px; text-decoration:none; font-size:15px;}
.pagenav .current{ padding-left:10px; padding-right:10px;font-size:15px; color:#ffffff;}
</style>
<div class="pagenav">{$show}</div>
</div>
</body>
<script>
//$.cookie("currentMenuID", "menuID", { path: "/"}); 
var weburl="__APP__";//右键查看网页源码，你会看出这个有值，有关 thinkphp 常量：http://document.thinkphp.cn/manual_3_2.html#const_reference
var bt_buy_s=document.getElementsByTagName("input");
for(var i=0;i<bt_buy_s.length;i++){
	if(bt_buy_s[i].className==="bt_buy"){
	   var bt=bt_buy_s[i];
	   
	   bt.onclick=function(){window.location=weburl+"/index.php/Home/Buycar/Add/bookid/"+this.getAttribute("myid");};//this是指触发的对象就是bt触发的click
	}
}
//注册行单击事件
$(".tr_line").each(function(){
	$(this).click(function(event){
		var ordersid=$(this).attr("data-id");
		$("#tr_"+ordersid).fadeToggle();
		//阻止事件冒泡
		if (event.stopPropagation) { 
		  event.stopPropagation(); 
		}else if (window.event) { // this code is for IE 
		  window.event.cancelBubble = true; 
		}
	});
});

$(".bt_info").each(function(){
	$(this).click(function(event){
	  var ordersid=$(this).attr("data-id");
	  $("#tr_"+ordersid).fadeToggle();
		//阻止事件冒泡
		if (event.stopPropagation) { 
		  event.stopPropagation(); 
		}else if (window.event) { // this code is for IE 
		  window.event.cancelBubble = true; 
		}
	});
});
//注册删除事件
$(".bt_del").each(function(){
	$(this).click(function(event){
		
		var ordersid=$(this).attr("data-id");
		$("#tr_"+ordersid).fadeToggle();
		if(confirm("确定要删除？")){
			  //不会就百度
			  //记得先打$.ajax()再打$.ajax({})接了再打参数，
			  $.ajax({
				  url:weburl+"/Home/Orders/del",
				  data:{'ordersid':ordersid},
				  success:function(data){
					   alert(data); //这个是ajax成功后的回调函数,中的data是返回回来的数据
					   
				  }
			   });
			 $(this).parent().parent().remove();//移除tr 按钮所在的父级元素就是td那么就是$(this).parent(),td上级元素则是tr所以就是$(this).parent().parent()
			 $("#tr_"+ordersid).remove();
		}
		
		//阻止事件冒泡
		if (event.stopPropagation) { 
		  event.stopPropagation(); 
		}else if (window.event) { // this code is for IE 
		  window.event.cancelBubble = true; 
		}
	});
});

           
</script>
</html>
